'use strict';

var chalk = require('chalk');

var SOAP_URL = 'https://www.sunat.gob.pe/ol-ti-itcpgem-beta/billService?wsdl';

var wsCredentials = {
  username: '20504561292MODDATOS',
  password: 'MODDATOS'
};

var soapParams = {
  fileName: '20504561292-01-FF11-5.zip',
  contentFile: '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'
};

module.exports = function(soap, options) {
  options = options || {};

  soap.createClient(SOAP_URL, options, function(err, client) {
    if (err) { return console.error(chalk.red('Error trying to create soap client:'), err); }

    client.setSecurity(new soap.WSSecurity(wsCredentials.username, wsCredentials.password));

    client.on('message', function(soapBody) {
      console.log(chalk.yellow('the soap body is:'), soapBody);
    });

    client.sendBill(soapParams, function(err, result) {
      if (err) { return console.error(chalk.red('Error trying to invoke .sendBill method:'), err); }

      console.log(chalk.yellow('Ok! Response:'), result);
    });
  });
};
